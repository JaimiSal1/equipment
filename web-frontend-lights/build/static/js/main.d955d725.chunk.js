(this["webpackJsonpweb-frontend"]=this["webpackJsonpweb-frontend"]||[]).push([[0],[,,,,,,,,,function(e,t,n){e.exports=n(19)},,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var a=n(0),s=n.n(a),i=n(8),c=n.n(i),r=(n(14),n(3)),u=(n(15),n(2)),l=n(1);function o(e,t){switch(t.type){case"connection_change":return Object(l.a)({},e,{connected:t.status});case"update_cue":return Object(l.a)({},e,{cue:t.cue});case"update_cue_list":return Object(l.a)({},e,{cues:t.cues});case"update_channel":return function(e,t){if(t.value<0||t.value>255)return e;var n=e.faders.map((function(e){return e.channel===t.channel?{channel:e.channel,value:t.value,status:t.status}:e}));return Object(l.a)({},e,{faders:n})}(e,t.value);case"update_channels":return function(e,t){var n,a=t,s=a.map((function(e){return e.channel})),i=Object(u.a)(e.faders);try{for(i.s();!(n=i.n()).done;){var c=n.value;-1===s.indexOf(c.channel)&&(c.value=0,c.status="manual",a.push(c),s.push(c.channel))}}catch(r){i.e(r)}finally{i.f()}return Object(l.a)({},e,{faders:a})}(e,t.values);case"update_lists":return function(e,t){var n,a={id:e.lists.id,name:"loading",lists:t},s=Object(u.a)(a.lists);try{for(s.s();!(n=s.n()).done;){var i=n.value;i.id===e.lists.id&&(a.name=i.name)}}catch(c){s.e(c)}finally{s.f()}return Object(l.a)({},e,{lists:a})}(e,t.lists);case"switch_list":return function(e,t){var n,a={id:t,name:"loading",lists:e.lists.lists},s=Object(u.a)(a.lists);try{for(s.s();!(n=s.n()).done;){var i=n.value;i.id===e.lists.id&&(a.name=i.name)}}catch(c){s.e(c)}finally{s.f()}return Object(l.a)({},e,{lists:a})}(e,t.id)}}n(16);function d(e){var t=e.state_modified,n=e.data,a=e.dispatch,i=e.server;return s.a.createElement("div",{className:"Fader"},s.a.createElement("p",{className:"_text _"+n.status},n.channel,": ",Math.round(n.value/255*100)),s.a.createElement("br",null),s.a.createElement("input",{className:"_fader",type:"range",min:"0",max:"255",value:n.value,onChange:function(e){return function(e,t,n,a){n.set_level(t.channel,parseInt(e.value)),a({type:"update_channel",value:Object(l.a)({},t,{value:parseInt(e.value)})})}(e.target,n,i,a)}}),s.a.createElement("button",{disabled:"manual"!==n.status,onClick:function(){return i.reset_channel(n.channel)}},"Reset"),s.a.createElement("button",{disabled:t||"tracked"===n.status,onClick:function(){return i.track_channel(n.channel)}},"Track"),s.a.createElement("button",{disabled:t||"tracked"!==n.status,onClick:function(){return i.block_channel(n.channel)}},"Block"))}var h=n(4),f=n(5),v=function(){function e(t,n){Object(h.a)(this,e),this.socket=void 0,this.dispatch=void 0,this.disconnect_timeout=void 0,this.list_id=void 0,this.dispatch=t,this.socket=this.connect(),this.list_id=n}return Object(f.a)(e,[{key:"connect",value:function(){var e=this;if(this.socket&&this.socket.readyState===WebSocket.OPEN)return this.socket;var t=new WebSocket("ws://localhost:8000");return t.onmessage=function(t){return e.onmessage(t.data)},t.onopen=function(){return e.onopen()},t.onclose=function(){void 0===e.disconnect_timeout&&(e.disconnect_timeout=window.setTimeout((function(){e.dispatch({type:"connection_change",status:!1})}),1e3)),setTimeout((function(){e.socket=e.connect()}),100)},t.onerror=function(){t.close()},this.socket=t,t}},{key:"disconnect",value:function(){console.log("disconnect"),this.onmessage=function(){},this.socket&&(this.socket.onclose=function(){},this.socket.close())}},{key:"onopen",value:function(){window.clearTimeout(this.disconnect_timeout),this.disconnect_timeout=void 0,this.dispatch({type:"connection_change",status:!0});var e={type:"get-levels",list_id:this.list_id};this.socket.send(JSON.stringify(e)),e={type:"list-cues",list_id:this.list_id},this.socket.send(JSON.stringify(e));this.socket.send(JSON.stringify({type:"get-lists"}))}},{key:"onmessage",value:function(e){try{var t=JSON.parse(e);switch(t.type){case"get-levels":this.get_levels(t);break;case"list-cues":this.list_cues(t);break;case"get-lists":this.get_lists(t);break;default:console.log("Unrecognized message type!")}}catch(n){console.error("Error while deserializing!")}}},{key:"get_levels",value:function(e){if(parseInt(e.list)===this.list_id){var t=e.values||[];this.dispatch({type:"update_channels",values:t.map((function(e){return{channel:parseInt(e.channel),value:parseInt(e.value),status:e.status}}))}),this.dispatch({type:"update_cue",cue:{current:parseInt(e.cue.current),fade_time:parseFloat(e.cue.fade_time),fade_progress:parseFloat(e.cue.fade_progress),fading:"true"===e.cue.fading,last:parseInt(e.cue.last),next:parseInt(e.cue.next),previous:parseInt(e.cue.previous)}})}}},{key:"get_lists",value:function(e){var t=e.lists||[];this.dispatch({type:"update_lists",lists:t.map((function(e){return{name:e.name,id:parseInt(e.number)}}))})}},{key:"list_cues",value:function(e){if(parseInt(e.list)===this.list_id){var t=e.cues||[];this.dispatch({type:"update_cue_list",cues:t.map((function(e){return parseInt(e.number)}))})}}},{key:"rename_list",value:function(e,t){e=Math.floor(e);var n={type:"rename-list",list_id:this.list_id,name:t};this.socket.send(JSON.stringify(n))}},{key:"delete_list",value:function(e){e=Math.floor(e);var t={type:"delete-list",list_id:this.list_id};this.socket.send(JSON.stringify(t))}},{key:"reset_channel",value:function(e){e=Math.floor(e);var t={type:"reset-channel",list_id:this.list_id,channel:e};this.socket.send(JSON.stringify(t))}},{key:"block_channel",value:function(e){e=Math.floor(e);var t={type:"block-channel",list_id:this.list_id,channel:e};this.socket.send(JSON.stringify(t))}},{key:"track_channel",value:function(e){e=Math.floor(e);var t={type:"track-channel",list_id:this.list_id,channel:e};this.socket.send(JSON.stringify(t))}},{key:"set_level",value:function(e,t){e=Math.floor(e),t=Math.floor(t);var n={type:"set-levels",list_id:this.list_id,values:[{channel:e,value:t}]};this.socket.send(JSON.stringify(n))}},{key:"save_cue",value:function(e,t){e=Math.floor(e);var n={type:"save-cue",list_id:this.list_id,cue:e,time:t};this.socket.send(JSON.stringify(n))}},{key:"delete_cue",value:function(e){e=Math.floor(e);var t={type:"delete-cue",list_id:this.list_id,cue:e};this.socket.send(JSON.stringify(t))}},{key:"restore_cue",value:function(e){e=Math.floor(e);var t={type:"restore-cue",list_id:this.list_id,cue:e};this.socket.send(JSON.stringify(t))}},{key:"go",value:function(){var e={type:"go-cue",list_id:this.list_id};this.socket.send(JSON.stringify(e))}},{key:"back",value:function(){var e={type:"back-cue",list_id:this.list_id};this.socket.send(JSON.stringify(e))}},{key:"save_to_disk",value:function(){this.socket.send(JSON.stringify({type:"save-to-disk"}))}}]),e}();n(17);function m(e){var t=e.data,n=(e.dispatch,e.cues),i=e.server,c=Object(a.useState)(t.current),u=Object(r.a)(c,2),l=u[0],o=u[1],d=Object(a.useState)(t.current),h=Object(r.a)(d,2),f=h[0],v=h[1],m=Object(a.useState)(t.fade_time),p=Object(r.a)(m,2),_=p[0],g=p[1];return Object(a.useEffect)((function(){t.current!==f&&(v(t.current),o(t.current),g(t.fade_time))}),[t,f]),s.a.createElement("div",{className:"CueStatus"},s.a.createElement("div",{className:"_view"},s.a.createElement("span",{className:"_previousQ"},t.previous,"\u2190"),s.a.createElement("span",{className:"_currentQ"},t.current),s.a.createElement("span",{className:"_nextQ"},"\u2192",t.next)),s.a.createElement("progress",{className:"_fadeProgress",max:"255",value:255*t.fade_progress}),s.a.createElement("div",{className:"_controls"},s.a.createElement("button",{className:"_back",onClick:function(){return i.back()},disabled:t.previous===t.current},"Back"),s.a.createElement("button",{className:"_go",onClick:function(){return i.go()},disabled:!t.fading&&t.next===t.current},"Go!"),s.a.createElement("div",{className:"_recording"},s.a.createElement("label",null,"Cue:",s.a.createElement("input",{type:"number",value:l,onChange:function(e){return o(parseInt(e.target.value)||0)}})),s.a.createElement("label",null,"Time:",s.a.createElement("input",{type:"number",value:_,onChange:function(e){return g(parseFloat(e.target.value)||0)}})),s.a.createElement("button",{className:"_record",onClick:function(){return i.save_cue(l,_)}},"Record"),s.a.createElement("div",null,s.a.createElement("button",{className:"_delete",onClick:function(){return function(e,t){!0===window.confirm("Are you sure you want to delete cue #".concat(e,"?"))&&t.delete_cue(e)}(l,i)}},"Delete"),s.a.createElement("select",{className:"_go_to_q",value:l,disabled:0===n.length,onChange:function(e){return i.restore_cue(parseInt(e.target.value))}},0===n.length?s.a.createElement("option",null,"No cues."):n.map((function(e){return s.a.createElement("option",{key:e,value:e},"Go to ",e)})))))))}var p=function(){function e(t,n,a){Object(h.a)(this,e),this.server=void 0,this.dispatch=void 0,this.input=void 0,this.timeouts=void 0,this.pending_recording=void 0,this.last_state=void 0,this.last_state=t,this.dispatch=n,this.server=a,this.connect(),this.timeouts=new Map,this.pending_recording=!1}return Object(f.a)(e,[{key:"connect",value:function(){var e=this;navigator.requestMIDIAccess?(console.log("WebMidi enabled"),navigator.requestMIDIAccess({sysex:!0}).then((function(t){return e.onaccess(t)}),(function(){return e.onfailure()}))):console.log("WebMidi is not supported")}},{key:"onaccess",value:function(e){var t=this,n=e.inputs;0===n.size&&console.log("No MIDI devices detected.");var a,s=Object(u.a)(n.entries());try{for(s.s();!(a=s.n()).done;){var i=a.value[1];if(i.manufacturer)return this.input=i,void(i.onmidimessage=function(e){return t.onmessage(e)})}}catch(c){s.e(c)}finally{s.f()}}},{key:"onfailure",value:function(){console.log("WebMidi access denied")}},{key:"onmessage",value:function(e){var t=this,n=e.data[1],a=2*e.data[2];if(n>8){if(0===a)return;this.pending_recording?(45===n||60===n?this.server.save_cue(this.last_state.cue.current,this.last_state.cue.fade_time):61===n?this.server.save_cue(this.last_state.cue.current-1,this.last_state.cue.fade_time):62===n&&this.server.save_cue(this.last_state.cue.current+1,this.last_state.cue.fade_time),this.pending_recording=!1):(41!==n&&44!==n||this.server.go(),42!==n&&43!==n||this.server.back(),45===n&&(this.pending_recording=!0),n>=64&&n<=71&&this.server.reset_channel(n-64))}else this.timeouts.has(n)&&clearTimeout(this.timeouts.get(n)),this.timeouts.set(n,window.setTimeout((function(){return t.ontimeout(n,a)}),1))}},{key:"ontimeout",value:function(e,t){this.server.set_level(e,t),this.timeouts.delete(e)}},{key:"update_state",value:function(e){this.last_state=e}}]),e}();n(18);function _(e){for(var t=e.data,n=e.dispatch,a=e.server,i=t.id,c=t.name,r=t.lists,u=r.map((function(e){return e.id})),l=0;-1!==u.indexOf(l);)l++;return s.a.createElement("div",{className:"list_controls"},"Cue List (",i+1,"/",r.length,"):\xa0\xa0",s.a.createElement("select",{value:i,onChange:function(e){return function(e,t){console.log(e),t({type:"switch_list",id:e})}(parseInt(e.target.value),n)}},r.map((function(e){return s.a.createElement("option",{key:e.id,value:e.id},e.name)})),s.a.createElement("option",{value:l},"Add new...")),s.a.createElement("button",{onClick:function(){return function(e,t,n){var a=prompt('Please enter a new name for this cue list (current is "'.concat(t,'")'));null!==a&&n.rename_list(e,a)}(i,c,a)}},"Rename"),s.a.createElement("button",{onClick:function(){return function(e,t,n,a,s){!0===window.confirm('Are you sure you want to delete all the cues in "'.concat(t,'"? This cannot be undone.'))&&(a.delete_list(e),s({type:"switch_list",id:0}))}(i,c,0,a,n)}},"Delete"))}var g={connected:!1,cue:{current:0,fade_time:1,fade_progress:1,fading:!1,last:0,next:0,previous:0},cues:[],faders:[{channel:0,value:0,status:"manual"},{channel:1,value:0,status:"manual"},{channel:2,value:0,status:"manual"},{channel:3,value:0,status:"manual"},{channel:4,value:0,status:"manual"},{channel:5,value:0,status:"manual"},{channel:6,value:0,status:"manual"},{channel:7,value:0,status:"manual"}],lists:{id:0,name:"N/A",lists:[]}};function k(e){var t,n=Object(a.useReducer)(o,g),i=Object(r.a)(n,2),c=i[0],u=i[1],l=Object(a.useRef)(null),h=Object(a.useRef)(null);if(Object(a.useEffect)((function(){return l.current=new v(u,c.lists.id),function(){var e;null===(e=l.current)||void 0===e||e.disconnect()}}),[c.lists.id]),Object(a.useEffect)((function(){l.current&&(h.current=new p(g,u,l.current))}),[l]),null===l.current)return s.a.createElement("div",null,"Loading...");if(!c.connected)return s.a.createElement("div",null,"Connecting...");null===(t=h.current)||void 0===t||t.update_state(c);var f=c.faders.reduce((function(e,t){return e||"manual"===t.status}),!1);return s.a.createElement("div",{className:"App"},s.a.createElement(_,{data:c.lists,server:l.current,dispatch:u}),s.a.createElement("div",{className:"FaderBank"},c.faders.sort((function(e,t){return e.channel>t.channel?1:-1})).map((function(e,t){return s.a.createElement(d,{key:t,state_modified:f,data:e,dispatch:u,server:l.current})}))),s.a.createElement(m,{data:c.cue,cues:c.cues,dispatch:u,server:l.current}),s.a.createElement("button",{onClick:function(){var e;return null===(e=l.current)||void 0===e?void 0:e.save_to_disk()}},"Save to Disk"))}Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(s.a.createElement(s.a.StrictMode,null,s.a.createElement(k,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}],[[9,1,2]]]);
//# sourceMappingURL=main.d955d725.chunk.js.map