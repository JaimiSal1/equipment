{"ast":null,"code":"import _slicedToArray from\"/home/artagan/Desktop/equipment/web-frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useReducer,useEffect,useRef}from'react';import'./App.css';import reducer from'../../reducer';import Fader from'../Fader/Fader';import Server from'../../server';import CueStatus from'../CueStatus/CueStatus';import Controller from'../../controller';import ListControls from'../ListControls/ListControls';/**\n * The application's overall state.  Every piece of server-side state the application needs\n * is also saved in here somewhere, plus any top-level local state.  This\n * should probably be a union of \"Loading\", \"Active\", and \"Error\" states.\n */ /**\n * The initial state of the application.  This should probably put the\n * application in \"Loading\" state and wait for the server to provide the\n * initial data.\n */export var initialState={connected:false,cue:{current:0,fade_time:1,fade_progress:1,fading:false,last:0,next:0,previous:0},cues:[],faders:[{channel:0,value:0,status:'manual'},{channel:1,value:0,status:'manual'},{channel:2,value:0,status:'manual'},{channel:3,value:0,status:'manual'},{channel:4,value:0,status:'manual'},{channel:5,value:0,status:'manual'},{channel:6,value:0,status:'manual'},{channel:7,value:0,status:'manual'}],lists:{id:0,name:\"N/A\",lists:[]}};export default function App(_props){var _controller$current;var _useReducer=useReducer(reducer,initialState),_useReducer2=_slicedToArray(_useReducer,2),state=_useReducer2[0],dispatch=_useReducer2[1];var server=useRef(null);var controller=useRef(null);useEffect(function(){server.current=new Server(dispatch,state.lists.id);return function(){var _server$current;(_server$current=server.current)===null||_server$current===void 0?void 0:_server$current.disconnect();};},[state.lists.id]);useEffect(function(){if(server.current){controller.current=new Controller(initialState,dispatch,server.current);}},[server]);if(server.current===null){return/*#__PURE__*/React.createElement(\"div\",null,\"Loading...\");}else if(!state.connected){return/*#__PURE__*/React.createElement(\"div\",null,\"Connecting...\");}(_controller$current=controller.current)===null||_controller$current===void 0?void 0:_controller$current.update_state(state);var state_modified=state.faders.reduce(function(prev,current){return prev||current.status===\"manual\";},false);return/*#__PURE__*/React.createElement(\"div\",{className:\"App\"},/*#__PURE__*/React.createElement(ListControls,{data:state.lists,server:server.current,dispatch:dispatch}),/*#__PURE__*/React.createElement(\"div\",{className:\"FaderBank\"},state.faders.sort(function(a,b){return a.channel>b.channel?1:-1;}).map(function(faderState,i){return/*#__PURE__*/React.createElement(Fader,{key:i,state_modified:state_modified,data:faderState,dispatch:dispatch,server:server.current});})),/*#__PURE__*/React.createElement(CueStatus,{data:state.cue,cues:state.cues,dispatch:dispatch,server:server.current}),/*#__PURE__*/React.createElement(\"button\",{onClick:function onClick(){var _server$current2;return(_server$current2=server.current)===null||_server$current2===void 0?void 0:_server$current2.save_to_disk();}},\"Save to Disk\"));}","map":{"version":3,"sources":["/home/artagan/Desktop/equipment/web-frontend/src/components/App/App.tsx"],"names":["React","useReducer","useEffect","useRef","reducer","Fader","Server","CueStatus","Controller","ListControls","initialState","connected","cue","current","fade_time","fade_progress","fading","last","next","previous","cues","faders","channel","value","status","lists","id","name","App","_props","state","dispatch","server","controller","disconnect","update_state","state_modified","reduce","prev","sort","a","b","map","faderState","i","save_to_disk"],"mappings":"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","sourcesContent":["import React, {useReducer, useEffect, useRef, MutableRefObject} from 'react';\nimport './App.css';\nimport reducer from '../../reducer';\nimport Fader, {FaderData} from '../Fader/Fader';\nimport Server from '../../server';\nimport CueStatus, {CueStatusData} from '../CueStatus/CueStatus';\nimport Controller from '../../controller';\nimport ListControls, {ListData} from '../ListControls/ListControls';\n\n\n/**\n * The application's overall state.  Every piece of server-side state the application needs\n * is also saved in here somewhere, plus any top-level local state.  This\n * should probably be a union of \"Loading\", \"Active\", and \"Error\" states.\n */\nexport type AppState = {\n  connected: boolean,\n  cue: CueStatusData,\n  cues: number[],\n  faders: FaderData[],\n  lists: ListData,\n}\n\n/**\n * The initial state of the application.  This should probably put the\n * application in \"Loading\" state and wait for the server to provide the\n * initial data.\n */\nexport const initialState: AppState = {\n  connected: false,\n  cue: {\n    current: 0,\n    fade_time: 1,\n    fade_progress: 1,\n    fading: false,\n    last: 0,\n    next: 0,\n    previous: 0,\n  },\n  cues: [],\n  faders: [\n    {channel: 0, value: 0, status: 'manual'},\n    {channel: 1, value: 0, status: 'manual'},\n    {channel: 2, value: 0, status: 'manual'},\n    {channel: 3, value: 0, status: 'manual'},\n    {channel: 4, value: 0, status: 'manual'},\n    {channel: 5, value: 0, status: 'manual'},\n    {channel: 6, value: 0, status: 'manual'},\n    {channel: 7, value: 0, status: 'manual'},\n  ],\n  lists: {\n    id: 0,\n    name: \"N/A\",\n    lists: [],\n  }\n}\n\nexport default function App(_props: {}) {\n  const [state, dispatch] = useReducer(reducer, initialState);\n\n  const server: MutableRefObject<Server | null> = useRef(null);\n  const controller: MutableRefObject<Controller | null> = useRef(null);\n  useEffect(() => {\n    server.current = new Server(dispatch, state.lists.id);\n    return () => {\n      server.current?.disconnect();\n    }\n  }, [state.lists.id]);\n\n  useEffect(() => {\n    if (server.current) {\n      controller.current = new Controller(initialState, dispatch, server.current as Server);\n    }\n  }, [server]);\n\n  if (server.current === null) {\n    return <div>Loading...</div>\n  } else if (!state.connected) {\n    return <div>Connecting...</div>\n  }\n  controller.current?.update_state(state);\n\n\n  const state_modified = state.faders.reduce((prev, current) => prev || current.status === \"manual\", false);\n\n  return (\n    <div className=\"App\">\n      <ListControls data={state.lists} server={server.current as Server} dispatch={dispatch}/>\n      <div className=\"FaderBank\">\n        {\n          state.faders.sort((a, b) => (a.channel > b.channel) ? 1 : -1).map((faderState: FaderData, i: number) => {\n            return <Fader key={i} state_modified={state_modified} data={faderState} dispatch={dispatch} server={server.current as Server}/>\n            })\n        }\n      </div>\n      <CueStatus data={state.cue} cues={state.cues} dispatch={dispatch} server={server.current as Server}/>\n      <button onClick={() => server.current?.save_to_disk()}>Save to Disk</button>\n    </div>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}